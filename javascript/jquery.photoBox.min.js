(function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d=typeof location!="undefined"&&location.href,e=d&&location.protocol&&location.protocol.replace(/\:/,""),f=d&&location.hostname,g=d&&(location.port||void 0),h=[];define("text",[],function(){var l,m,s;return typeof window!="undefined"&&window.navigator&&window.document?m=function(a,b){var c=l.createXhr();c.open("GET",a,!0),c.onreadystatechange=function(){c.readyState===4&&b(c.responseText)},c.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(s=require.nodeRequire("fs"),m=function(a,b){var c=s.readFileSync(a,"utf8");c.indexOf("﻿")===0&&(c=c.substring(1)),b(c)}):typeof Packages!="undefined"&&(m=function(a,b){var c=new java.io.File(a),d=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),e,f,g="";try{e=new java.lang.StringBuffer,(f=c.readLine())&&f.length()&&f.charAt(0)===65279&&(f=f.substring(1));for(e.append(f);(f=c.readLine())!==null;)e.append(d),e.append(f);g=String(e.toString())}finally{c.close()}b(g)}),l={version:"1.0.7",strip:function(a){if(a){var a=a.replace(b,""),d=a.match(c);d&&(a=d[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}if(!b)throw Error("createXhr(): XMLHttpRequest not available");return b},get:m,parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),a=a.substring(c+1,a.length),c=a.indexOf("!");return c!==-1&&(b=a.substring(c+1,a.length),b=b==="strip",a=a.substring(0,c)),{moduleName:d,ext:a,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=l.xdRegExp.exec(a),f;return e?(a=e[2],e=e[3],e=e.split(":"),f=e[1],e=e[0],(!a||a===b)&&(!e||e===c)&&(!f&&!e||f===d)):!0},finishLoad:function(a,b,c,d,e){c=b?l.strip(c):c,e.isBuild&&(h[a]=c),d(c)},load:function(a,b,c,h){if(h.isBuild&&!h.inlineText)c();else{var j=l.parseName(a),k=j.moduleName+"."+j.ext,m=b.toUrl(k),n=h&&h.text&&h.text.useXhr||l.useXhr;!d||n(m,e,f,g)?l.get(m,function(b){l.finishLoad(a,j.strip,b,c,h)}):b([k],function(a){l.finishLoad(j.moduleName+"."+j.ext,j.strip,a,c,h)})}},write:function(a,b,c){if(b in h){var d=l.jsEscape(h[b]);c.asModule(a+"!"+b,"define(function () { return '"+d+"';});\n")}},writeFile:function(a,b,c,d,e){var b=l.parseName(b),f=b.moduleName+"."+b.ext,g=c.toUrl(b.moduleName+"."+b.ext)+".js";l.load(f,c,function(){var b=function(a){return d(g,a)};b.asModule=function(a,b){return d.asModule(a,g,b)},l.write(a,f,b,e)},e)}}})})(),define("text!../template/photoBox.hbs",[],function(){return'    <div id="photoBox" class="photoBox hidden">\n      <div class="pb-close"><a href="#">╳</a></div>\n      <div class="pb-viewer">\n        <div class="pb-layer" >\n          <div class="pb-main-image loading">\n            <img src="" style="display:none" onload="var w=this.width;var h=this.height;$(this).parent().css({width:w, height:h, marginLeft:-w/2, marginTop:-h/2, top:\'50%\', left:\'50%\'})">\n          </div>\n        </div>\n        <div class="pb-desc">\n          <div class="pb-title">this is desc</div>\n          <div class="pb-comments">\n            this is comments\n          </div>\n        </div>\n      </div>\n      <div class="pb-preview">\n        <div class="pb-spliter"></div>\n        <div class="pb-left-handler"><a href="#">previus</a></div>\n        <div class="pb-right-handler"><a href="#">next</a></div>\n        <div class="pb-list-wrapper">\n          <ul class="pb-list">\n            {{#each list}}\n            <li style="background-image:url({{this.thumb}})"><a href="#">title</a></li>\n            {{/each}}\n          </ul>\n        </div>\n      </div>\n    </div>\n    <div id="photoBoxShadow" class="photoBox hidden"/>\n'}),function(){define("photoBoxView",["module","text!../template/photoBox.hbs"],function(a,b){var c,d;return d=a.id,c=Backbone.View.extend({relayout:function(){var a,b,c,d,e,f,g;if(this.$("#photoBox").css("visibility")==="hidden")return;return b=10,c=this.$(".pb-desc").is(":hidden")?0:this.$(".pb-desc").width(),g=$("body").width()-c-40-30,f=$("body").height()-40-this.$(".pb-preview").height(),this.$(".pb-viewer").height(f),this.$(".pb-layer").width(g),e=g,this.$(".pb-main-image img").css({maxWidth:g-b,maxHeight:f-20}).trigger("load"),d=$("body").width()-100,this.$(".pb-list-wrapper").width(d),a=this.$("#photoBox .pb-list li"),this.$("#photoBox .pb-list").width(a.length*(a.width()+8))},events:{"click .pb-list li":"selectPhoto","click .pb-close":"close","click .pb-left-handler":"previous","click .pb-right-handler":"next"},next:function(a){var b,c,d,e,f;b=this.$("#photoBox .pb-list"),d=parseInt(b.css("left"),10),e=-(this.$("#photoBox .pb-list").width()-this.$(".pb-list-wrapper").width()),f=Math.abs(d-e);if(!(f<=0))return c=Math.min(400,f),this.$("#photoBox .pb-list").animate({left:"-="+c},200)},previous:function(a){var b,c,d,e,f;b=this.$("#photoBox .pb-list"),d=parseInt(b.css("left"),10),e=0,f=Math.abs(d-e);if(!(f<=0))return c=Math.min(400,f),this.$("#photoBox .pb-list").animate({left:"+="+c},200)},open:function(a){var b=this;this.$("#photoBoxShadow").attr("class","photoBox open").one("webkitTransitionEnd",function(a){return _.delay(function(){return b.$("#photoBox").removeClass("hidden"),b.relayout(),b.$("#photoBoxShadow").addClass("hidden")},200)});if(a!=null)return this.$(".pb-list>li").eq(a).trigger("click")},close:function(a){var b=this;return this.$("#photoBox").addClass("hidden"),this.$("#photoBoxShadow").removeClass("hidden open").addClass("close").one("webkitTransitionEnd",function(a){return _.delay(function(){return b.$("#photoBox").addClass("hidden"),b.$("#photoBoxShadow").addClass("hidden")},200)})},selectPhoto:function(a){var b,c,d,e,f=this;return b=$(a.currentTarget),c=this.$(".pb-list>li").index(b),e=this.data[c].original,this.$(".pb-list>li>a").removeClass("active"),this.$(".pb-main-image").addClass("loading"),this.$(".pb-main-image img").fadeOut(),b.find("a").addClass("active"),d=new Image,d.onload=function(){return f.$(".pb-main-image").removeClass("loading"),f.$(".pb-main-image img").attr("src",d.src).fadeIn()},d.src=e},render:function(){var a,c,d,e=this;return c=Handlebars.compile(b),d={list:this.data},this.$el.append(c(d)),a=this.$el,this.$(".pb-list").draggable({axis:"x",drag:function(a,b){var c,d,f;c=b.position.left,f=-(e.$(".pb-list").width()-e.$(".pb-list-wrapper").width()),d=0;if((c-d)*(c-f)>0)return!1}})},initialize:function(a){var b=this;return this.data=a,console.log("initialize",this.data),this.render(),$(window).resize(_.debounce(function(){return b.relayout()},200)).on("keydown",function(a){switch(a.which){case 27:return b.close()}}),this.relayout()}}),c})}.call(this),function(){define("photoBox",["module","photoBoxView"],function(a,b){var c,d;return d=a.id,c=function(){function a(a){this.data=a,this.photoBoxView=new b(this.data),console.log(d,this.photoBoxView),$("body").append(this.photoBoxView.$el)}return a.prototype.open=function(a){return this.photoBoxView.open(a)},a}(),c})}.call(this),function(){require(["module","photoBox"],function(a,b){return $.fn.photoBox=function(){var a,c,d;return a=this,c=[],a.each(function(a,b){return c.push({thumb:$(b).find("img").attr("src"),original:$(b).attr("href")})}).on("click",function(b){var c;return c=a.index(this),d.open(c),b.preventDefault()}),d=new b(c)}})}.call(this),define("jquery.photoBox",function(){})