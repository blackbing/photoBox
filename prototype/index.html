<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>prototype of photoBox </title>
    <style>
      html, body{
        height: 100%;
        font-size: 80px;
        text-align: center;
      }

    </style>
    <link href="../stylesheets/style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    BACKGROUND<br>
    <a href="#" id="show" onclick="$('.photoBox').trigger('open');">photoBox</a>
    <div class="photoBox">
      <div class="pb-close"><a href="#">â•³</a></div>
      <div class="pb-viewer">
        <div class="pb-layer" >
          <div class="pb-main-image">
            <img src="http://dl.dropbox.com/u/751847/Warhol/PhotoStories/5UDVirbQ/2012-06-01%2011.52.42.jpg" onload="var w=this.width;var h=this.height;$(this).parent().css({width:w, height:h, marginLeft:-w/2, marginTop:-h/2, top:'50%', left:'50%'})">
          </div>
        </div>
        <div class="pb-desc">
          <div class="pb-title">this is desc</div>
          <div class="pb-comments">
            <div class="fb-comments" data-href="http://example.com" data-num-posts="8" data-width="290" data-colorscheme="dark"></div>
          </div>
        </div>
      </div>
      <div class="pb-preview">
        <div class="pb-spliter"></div>
        <div class="pb-left-handler"><a href="#">previus</a></div>
        <div class="pb-right-handler"><a href="#">next</a></div>
        <div class="pb-list-wrapper">
          <ul class="pb-list">
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.47.27.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-06-01%2011.52.14-2.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-06-01%2011.52.19.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-06-01%2011.52.21.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.08.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.15.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.33.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2010.21.56.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2011.38.40.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2011.41.21.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2012.05.12.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2012.05.22.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.47.27.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.08.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.15.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2009.50.33.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2010.21.56.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2011.38.40.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2011.41.21.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2012.05.12.jpg)"><a href="#">title</a></li>
            <li style="background-image:url(http://dl.dropbox.com/u/751847/Warhol/PhotoStories/6RjTF9jz/2012-04-02%2012.05.22.jpg)"><a href="#">title</a></li>
          </ul>
        <div>
      </div>
    </div>


    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
    <script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="http://documentcloud.github.com/backbone/backbone-min.js"></script>

    <script>
    var require = {"baseUrl":'../javascript'}
    </script>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/zh_TW/all.js#xfbml=1&appId=249435295153567";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <script data-main="main" src="http://requirejs.org/docs/release/1.0.7/minified/require.js"></script>
    <script>
      $(document).ready(function(){
        var relayout = _.debounce(function(event){
          var delta = 10;
          var bodyHeight = $('body').height() - delta;
          var bodyWidth = $('body').width() - delta;
          $('.photoBox').css({
            top: '50%',
            left: '50%',
            width: bodyWidth,
            height: bodyHeight,
            marginLeft: -(bodyWidth/2),
            marginTop: -(bodyHeight/2)
          });
          var viewerWidth = $('body').width() - $('.pb-desc').width() - (20*2) - 30;

          var viewerHeight = $('body').height() - (20*2) - $(".pb-preview").height();

          $('.pb-viewer').height(viewerHeight);
          $(".pb-layer").width(viewerWidth);

          var maxWidth = viewerWidth;
          $('.pb-main-image img').css({
            maxWidth: viewerWidth-delta,
            maxHeight: viewerHeight-20
          }).trigger('load');


          var listWidth = $('body').width() - (50*2);
          $(".pb-list-wrapper").width(listWidth);

          var $list = $('.photoBox .pb-list li')
          //4 is margin
          $('.photoBox .pb-list').width($list.length * ($list.width()+4*2))

        }, 200);


        $(window).resize(relayout);
        relayout();


        //FIXME: backbone events
        $('.photoBox').on('click', '.pb-list li', function(){
          $('.photoBox .pb-list>li>a').removeClass('active');
          $(this).find('a').addClass('active');
          var bkImgReg = /url\((.+)\)/;
          var bkImg = bkImgReg.exec($(this).css('background-image'));
          if(bkImg){
            $('.pb-main-image img').attr('src', bkImg[1]);
          }

        });
        $('.photoBox').on('click', '.pb-left-handler', function(){
          var $list = $('.photoBox .pb-list');
          var list_left = parseInt($list.css('left'), 10);
          var min = 0;
          var remain = Math.abs(list_left - min);
          if(remain <= 0){
            return;
          }else{
            var left = Math.min(400, remain);
            $('.photoBox .pb-list').animate({
              left: '+='+left
            }, 200);
          }
        });
        $('.photoBox').on('click', '.pb-right-handler', function(){
          var $list = $('.photoBox .pb-list');
          var list_left = parseInt($list.css('left'), 10);
          var min = -($('.photoBox .pb-list').width() - $('.pb-list-wrapper').width());
          var remain = Math.abs(list_left - min);
          if(remain <= 0){
            return;
          }else{
            var left = Math.min(400, remain);
            $('.photoBox .pb-list').animate({
              left: '-='+left
            }, 200);
          }
        });
        $('.photoBox').bind('close', function(){
          $('.photoBox>.pb-preview').hide();
          $('.photoBox>.pb-viewer').hide();
          //$('.photoBox').animate({height:0, marginTop:-$(this).height()/2}, 200);
          $('.photoBox').animate({height:3, marginTop:'+='+$('body').height()/2}, 200)
          .queue(function(){
            $(this).dequeue();
          }).animate({width: 0, marginLeft: '+='+$('body').width()/2},300);
        });
        $('.photoBox').on('click', '.pb-close', function(){
          $('.photoBox').trigger('close');
        });
        $('.photoBox').bind('open', function(){
          var h = $('body').height() -10;
          var w = $('body').width() -10;
          $('.photoBox').animate({width: w, marginLeft: '-'+w/2},300)
          .queue(function(){$(this).dequeue();})
          .animate({height:h, marginTop:'-'+h/2}, 200)
          .queue(function(){
            $('.photoBox>.pb-preview').show();
            $('.photoBox>.pb-viewer').show();
            $(this).dequeue();
          });

        });
        $('.photoBox .pb-list').draggable({
          axis: "x",
          drag: function(event, ui){
            var left = ui.position.left;
            //FIXME: improvement
            var min = -($('.photoBox .pb-list').width() - $('.pb-list-wrapper').width());
            var max = 0;

            if( (left-max)*(left-min)>0  ){
              return false;
            }

          }
        });


      });
    </script>
  </body>
</html>

